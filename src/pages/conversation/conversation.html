<ion-header>
    <div class="appheader">
        <div class="top">
            <button class="icon-btn i i-arrow-left"
                (tap)="back()"></button>
            <div class="title">{{ printName() }}</div>
            <button class="icon-btn i-dots" (click)="showSettings($event)"></button>
        </div>
        <div class="bottom">
            <div class="subtitle">{{ printSubtitle() }}</div>
            <div class="avatars" *ngIf="!loadingUsers">
                <div *ngFor="let user_id of users" class="avatar" 
                    [backgroundImg]="userModel.list[user_id].datum.avatar | dmsUrl: [50,'x',50]"
                    [biToken]="userModel.list[user_id].datum.avatar+'50'">
                    {{ userModel.list[user_id].datum | userletter }}
                </div>
            </div>
        </div>
    </div>    
</ion-header>

<ion-content>
    <div class="loader" *ngIf="loading">
        <ion-spinner></ion-spinner>
    </div>

    <ion-refresher (ionRefresh)="previous($event)" [enabled]="!loading && !hasToCreate">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <div class="messages" *ngIf="!loading && messagesPaginator">
        <message *ngFor="let messageId of messagesPaginator.displayableIndexes; trackBy trackMessageId;"
            [messageId]="messageId" [paginator]="messagesPaginator" (tap)="messageTapped(messageId)"
            [readIds]="usersLastUnreadId" [loaded]="onMessageLoaded"></message>
    </div>
    
    <div class="messages" *ngIf="!loading && messagesPaginator">
        <message *ngFor="let message of messagesPaginator.sendingMessages"
            [sending]="true" [message]="message" [paginator]="messagesPaginator" [loaded]="onMessageLoaded"></message>
    </div>        

    <div class="queued-messages" *ngIf="!loading && (!messagesPaginator || !messagesPaginator.sendingMessages.length)">
        <message *ngFor="let message of queuedMessages" [sending]="true"
            [message]="message" [paginator]="messagesPaginator" [loaded]="onMessageLoaded"></message>
    </div>
    
    <writing *ngIf="writer" [writer]="writer" [paginator]="messagesPaginator" [loaded]="onMessageLoaded"></writing>

</ion-content>

<ion-footer>

    <div class="sender">
        
        <div class="dta">
            <textarea #senderArea placeholder="Say something..." type="text" (input)="onTyping(senderArea)"
                [(ngModel)]="text" (keydown.enter)="send(senderArea, $event )" name="text"></textarea>
            <div class="dta-copy">{{ text }}</div>
        </div>
        <button class="icon-btn i i-send send" [class.active]="text" (click)="send(senderArea);"></button>
    </div>

</ion-footer>